{% extends "layouts/base.html.twig" %}
{% import "components/ui.html.twig" as ui %}

{% block title %}Імпорт пацієнтів з JSON - Клініка{% endblock %}

{% block body %}
    <div class="ui segment">
        <h2 class="ui header">Імпорт пацієнтів з JSON</h2>
        <div class="ui divider"></div>

        {% if success_message %}
            <div class="ui success message">
                <div class="header">Успіх!</div>
                <p>{{ success_message }}</p>
            </div>
        {% endif %}

        {% if errors %}
            <div class="ui error message">
                <div class="header">Помилка імпорту</div>
                <ul class="list">
                    {% for error in errors %}
                        {% if error is iterable %}
                            {% for e in error %}
                                <li>{{ e }}</li>
                            {% endfor %}
                        {% else %}
                            <li>{{ error }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <form class="ui form" method="POST" action="/patients/import-json" enctype="multipart/form-data">
            <div class="field">
                <label>Оберіть JSON файл</label>
                <div class="ui action input">
                    <input type="text" id="json-file-display" readonly placeholder="Файл не обрано">
                    <label for="json-file-input" class="ui button">Обрати файл</label>
                </div>
                <input type="file" id="json-file-input" name="json_file" accept=".json" style="display: none;">
            </div>

            {{ ui.button('Імпортувати', 'primary', 'large', 'upload') }}
            <a href="/patients" class="ui button">Скасувати</a>
        </form>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('json-file-input');
            const display = document.getElementById('json-file-display');

            if (fileInput && display) {
                fileInput.addEventListener('change', function() {
                    display.value = fileInput.files.length ? fileInput.files[0].name : 'Файл не обрано';
                });
            }
        });
    </script>
{% endblock %}
