{% extends "layouts/base.html.twig" %}

{% block title %}Пацієнт {{ patient.first_name }} {{ patient.last_name }} - Клініка{% endblock %}

{% block body %}
    <div class="ui segment">
        <h2 class="ui header">Картка пацієнта: {{ patient.last_name }} {{ patient.first_name }} {{ patient.middle_name }}</h2>
        <div class="ui divider"></div>

        <div class="ui grid">
            <div class="eight wide column">
                <h3 class="ui header">Основна інформація</h3>
                <table class="ui unstackable definition table">
                    <tbody>
                        <tr>
                            <td>ID</td>
                            <td>{{ patient.id }}</td>
                        </tr>
                        <tr>
                            <td>Дата народження</td>
                            <td>{{ patient.birth_date }}</td>
                        </tr>
                        <tr>
                            <td>Стать</td>
                            <td>{{ patient.gender }}</td>
                        </tr>
                        <tr>
                            <td>Телефон</td>
                            <td>{{ patient.phone }}</td>
                        </tr>
                        <tr>
                            <td>Email</td>
                            <td>{{ patient.email }}</td>
                        </tr>
                        <tr>
                            <td>Адреса</td>
                            <td>{{ patient.address }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="eight wide column">
                <h3 class="ui header">Додаткова інформація</h3>
                <table class="ui unstackable definition table">
                    <tbody>
                        <tr>
                            <td>РНОКПП</td>
                            <td>{{ patient.tax_id }}</td>
                        </tr>
                        <tr>
                            <td>ID-картка/паспорт</td>
                            <td>{{ patient.document_id }}</td>
                        </tr>
                        <tr>
                            <td>Сімейний стан</td>
                            <td>{{ patient.marital_status }}</td>
                        </tr>
                        <tr>
                            <td>Статус</td>
                            <td>{{ patient.status == 'active' ? 'Активний' : 'Архівний' }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="ui divider"></div>

        <a href="/patients/edit?id={{ patient.id }}" class="ui primary button">Редагувати</a>
        <a href="/prescriptions/new?patient_id={{ patient.id }}" class="ui teal button">Створити рецепт</a>
        {% if patient.status == 'active' %}
            <form action="/patients/toggle-status" method="POST" style="display: inline;">
                <input type="hidden" name="id" value="{{ patient.id }}">
                <button type="submit" class="ui negative button">Архівувати</button>
            </form>
        {% else %}
            <form action="/patients/toggle-status" method="POST" style="display: inline;">
                <input type="hidden" name="id" value="{{ patient.id }}">
                <button type="submit" class="ui positive button">Активувати</button>
            </form>
        {% endif %}
        <a href="/patients" class="ui button">Повернутися до списку</a>
    </div>

    <div class="ui segment">
        <h3 class="ui header">Записи на прийом</h3>
        {% if appointments is not empty %}
            <table class="ui celled unstackable table">
                <thead>
                    <tr>
                        <th>Дата/час</th>
                        <th>Лікар</th>
                        <th>Статус</th>
                        <th>Дії</th>
                    </tr>
                </thead>
                <tbody>
                    {% for appointment in appointments %}
                        <tr>
                            <td>{{ appointment.start_time|date('Y-m-d H:i') }}</td>
                            <td>{{ appointment.doctor_name ?? 'Невідомий' }}</td>
                            <td>{{ appointment.status }}</td>
                            <td>
                                <a class="ui icon button" href="/medical-records/new?appointment_id={{ appointment.id }}">
                                    <i class="plus icon"></i> Створити медзапис
                                </a>
                                <a class="ui icon button" href="/prescriptions/new?patient_id={{ patient.id }}">
                                    <i class="file prescription icon"></i> Створити рецепт
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="ui message">Немає запланованих візитів.</div>
        {% endif %}
    </div>

    <div class="ui segment">
        <h3 class="ui header">Медичні записи</h3>
        <table class="ui celled unstackable table">
            <thead>
                <tr>
                    <th>Дата візиту</th>
                    <th>Лікар</th>
                    <th>Діагноз</th>
                    <th>Дії</th>
                </tr>
            </thead>
            <tbody>
                {% for record in medical_records %}
                    <tr>
                        <td>{{ record.visit_date|date('Y-m-d H:i') }}</td>
                        <td>{{ record.doctor_name }}</td>
                        <td>{{ record.diagnosis_code }}</td>
                        <td>
                            <a href="/medical-records/show?id={{ record.id }}" class="ui icon button">
                                <i class="eye icon"></i>
                            </a>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="4" class="center aligned">Немає медичних записів для відображення.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
