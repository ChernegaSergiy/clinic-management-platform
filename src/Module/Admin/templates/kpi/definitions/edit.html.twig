{% extends "layouts/base.html.twig" %}
{% import "components/forms.html.twig" as forms %}
{% import "components/ui.html.twig" as ui %}

{% block title %}Редагувати визначення KPI #{{ definition.id }} - Адмінка{% endblock %}

{% block body %}
    <div class="ui segment">
        <h2 class="ui header">Редагувати визначення KPI #{{ definition.id }}</h2>
        <div class="ui divider"></div>

        {% set kpi_options = {
            'revenue_generated': 'Дохід (revenue_generated)',
            'appointments_count': 'Кількість прийомів (appointments_count)',
            'doctor_utilization': 'Завантаженість лікарів (doctor_utilization)',
            'readmission_rate': 'Повторні звернення (readmission_rate)',
            'patient_satisfaction': 'Задоволеність пацієнтів (patient_satisfaction)',
            'custom': 'Інше (manual)'
        } %}
        {% set selected_type = old.kpi_type ?? definition.kpi_type %}
        {% if selected_type is not empty and (selected_type not in kpi_options|keys) %}
            {% set kpi_options = kpi_options|merge({ (selected_type): selected_type ~ ' (custom)' }) %}
        {% endif %}

        <form class="ui form" method="POST" action="/admin/kpi_definitions/edit?id={{ definition.id }}">
            {{ forms.input('name', 'Назва', old.name ?? definition.name, 'text', 'Наприклад, Patient Wait Time', errors.name ?? null, {'required': 'required'}) }}
            {{ forms.textarea('description', 'Опис', old.description ?? definition.description, 'Детальний опис KPI', errors.description ?? null) }}
            {{ forms.select('kpi_type', 'Тип KPI', kpi_options, selected_type, errors.kpi_type ?? null, {'required': 'required'}) }}
            {{ forms.input('target_value', 'Цільове значення', old.target_value ?? definition.target_value, 'text', 'Наприклад, 15, 95%, 100', errors.target_value ?? null) }}
            {{ forms.input('unit', 'Одиниця виміру', old.unit ?? definition.unit, 'text', 'Наприклад, minutes, %, patients', errors.unit ?? null) }}

            <div class="field">
                <div class="ui checkbox">
                    <input type="checkbox" name="is_active" {% if (old.is_active is defined and old.is_active) or (old.is_active is not defined and definition.is_active) %}checked{% endif %} value="1">
                    <label>Активне визначення</label>
                </div>
            </div>

            {{ ui.button('Зберегти зміни', 'primary', 'large', 'save') }}
            <a href="/admin/kpi_definitions" class="ui button">Скасувати</a>
        </form>
    </div>
{% endblock %}
